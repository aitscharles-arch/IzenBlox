<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IZENBLOX</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Montserrat:wght@300;600&family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Orbitron,system-ui,sans-serif;
  background:radial-gradient(circle at top,#0a021c,#020008,#000);
  color:#fff;
  overflow-x:hidden;
}

/* NAVBAR */
nav{
  position:fixed;
  top:0;left:0;
  width:100%;
  height:80px;
  background:rgba(2,0,24,0.95);
  border-bottom:2px solid #00f6ff;
  backdrop-filter:blur(18px);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 40px;
  z-index:999;
}
.nav-left{
  display:flex;
  align-items:center;
  gap:15px;
}
.logo{
  font-size:24px;
  letter-spacing:5px;
  color:#00f6ff;
  text-shadow:0 0 20px #00f6ff,0 0 40px #ff00ff;
}
.nav-tagline{
  font-size:11px;
  color:#aaa;
}
.nav-links{
  display:flex;
  gap:12px;
}
.nav-links button{
  background:transparent;
  border:1px solid #00f6ff;
  color:#00f6ff;
  padding:8px 16px;
  border-radius:999px;
  cursor:pointer;
  font-size:13px;
  transition:.25s;
  white-space:nowrap;
}
.nav-links button:hover{
  background:linear-gradient(90deg,#00f6ff,#ff00ff);
  color:#020008;
  box-shadow:0 0 20px #00f6ff;
}
#navCommunityBtn{
  background:linear-gradient(90deg,#ff00ff,#00f6ff,#00ff88);
  color:#020008;
  border:none;
  font-weight:700;
  box-shadow:0 0 20px #ff00ff;
}
.nav-right{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:12px;
}
#navUser{
  max-width:120px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
#navAuthBtn{
  background:#00f6ff;
  color:#020008;
  border:none;
  padding:8px 16px;
  border-radius:999px;
  cursor:pointer;
  font-size:12px;
  font-weight:600;
  box-shadow:0 0 16px #00f6ff;
}

/* GENERIC PAGE LAYOUT */
.page{
  display:none;
  padding-top:110px;
  min-height:100vh;
}
.page.active{display:block;}

.section{
  width:90%;
  max-width:1200px;
  margin:0 auto 50px auto;
  background:rgba(3,0,30,0.92);
  border-radius:26px;
  border:1px solid rgba(0,246,255,0.3);
  box-shadow:0 0 35px rgba(0,246,255,0.25);
  padding:30px;
}

/* HERO HOME */
.hero-wrap{
  width:90%;
  max-width:1200px;
  margin:0 auto 40px auto;
  display:grid;
  grid-template-columns:minmax(0,2fr) minmax(0,1.5fr);
  gap:30px;
  align-items:center;
}
@media(max-width:900px){
  .hero-wrap{grid-template-columns:1fr;}
}
.hero-title{
  font-size:42px;
  line-height:1.1;
  text-shadow:0 0 20px #00f6ff;
}
.hero-title span{color:#00f6ff;}
.hero-sub{
  margin-top:14px;
  font-size:14px;
  color:#d8d8ff;
}
.hero-cta{
  margin-top:24px;
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}
.hero-cta button{
  border:none;
  border-radius:999px;
  padding:12px 22px;
  cursor:pointer;
  font-size:13px;
  font-weight:700;
}
.btn-primary{
  background:linear-gradient(90deg,#00f6ff,#ff00ff);
  color:#020008;
  box-shadow:0 0 25px #00f6ff;
}
.btn-ghost{
  background:transparent;
  border:1px solid #ff00ff;
  color:#ff86ff;
}
.hero-card{
  position:relative;
  min-height:220px;
  border-radius:26px;
  overflow:hidden;
  background:
    radial-gradient(circle at 10% 0,#ff00ff33,transparent 55%),
    radial-gradient(circle at 90% 100%,#00f6ff33,transparent 55%),
    #050014;
  border:1px solid rgba(255,255,255,0.08);
  padding:22px;
}
.hero-pill{
  position:absolute;
  top:14px;right:24px;
  font-size:10px;
  padding:6px 12px;
  border-radius:999px;
  background:rgba(0,0,0,0.6);
  border:1px solid #00f6ff;
}
.hero-card h3{margin-top:10px;font-size:16px;}
.hero-card ul{
  margin-top:14px;
  font-size:12px;
  list-style:none;
}
.hero-card ul li::before{
  content:"‚óÜ ";
  color:#00f6ff;
}

/* GRID CARDS */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:20px;
}
.card{
  background:rgba(6,2,40,0.95);
  border-radius:22px;
  border:1px solid rgba(0,246,255,0.25);
  padding:18px 18px 20px;
  text-align:left;
  font-size:13px;
  box-shadow:0 0 20px rgba(0,246,255,0.12);
}
.card h2{font-size:17px;margin-bottom:6px;}
.card small{font-size:11px;color:#aaa;}
.card strong{color:#00ff9d;}
.card img{
  width:100%;
  border-radius:16px;
  margin-top:10px;
}

/* FORM ELEMENTS */
input,textarea,select{
  width:100%;
  padding:10px 12px;
  margin:6px 0 10px 0;
  border-radius:12px;
  border:none;
  outline:none;
  font-family:inherit;
  font-size:13px;
  background:#05001a;
  color:#fff;
}
textarea{min-height:70px;resize:vertical;}

.auth-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:24px;
}
.auth-title{margin-bottom:10px;font-size:18px;}

.avatars{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:8px;
}
.avatars img{
  width:64px;height:64px;
  border-radius:50%;
  border:2px solid #00f6ff77;
  cursor:pointer;
  transition:.2s;
}
.avatars img:hover{
  transform:scale(1.08);
  border-color:#00f6ff;
  box-shadow:0 0 15px #00f6ff;
}
#avatarPreview{
  width:90px;height:90px;
  border-radius:50%;
  border:3px solid #ff00ff;
  margin-top:10px;
  object-fit:cover;
}

/* COMMUNITY */
.community-layout{
  display:grid;
  grid-template-columns:minmax(0,2.4fr) minmax(0,1.4fr);
  gap:20px;
}
@media(max-width:950px){
  .community-layout{grid-template-columns:1fr;}
}
.chat-box{
  background:#05001a;
  border-radius:18px;
  border:1px solid rgba(0,246,255,0.35);
  padding:14px;
}
#chatFeed{
  max-height:380px;
  overflow-y:auto;
  padding-right:4px;
}
.message{
  margin-bottom:12px;
  padding:10px 10px 8px;
  border-left:3px solid #00f6ffcc;
  background:rgba(7,2,40,0.95);
  border-radius:10px;
  font-size:13px;
}
.msg-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:4px;
}
.msg-user{
  display:flex;
  align-items:center;
  gap:8px;
}
.msg-user img{
  width:24px;height:24px;
  border-radius:50%;
  border:1px solid #00f6ffaa;
}
.msg-meta{
  font-size:10px;
  color:#aaa;
}
.msg-actions span{
  font-size:11px;
  margin-left:10px;
  cursor:pointer;
  color:#00f6ff;
}
.msg-actions span.like{
  color:#ff78ff;
}
.mention{color:#ff9ee5;font-weight:700;}

.chat-input-row{
  display:flex;
  gap:8px;
  margin-top:10px;
}
.chat-input-row input{
  flex:1;
}
.chat-input-row button{
  padding:10px 16px;
  border-radius:12px;
  border:none;
  background:linear-gradient(90deg,#00f6ff,#00ff88);
  color:#020008;
  font-size:13px;
  font-weight:700;
  cursor:pointer;
}

/* PROFILE / DM SIDE */
.profile-panel{
  background:#05001a;
  border-radius:18px;
  border:1px solid rgba(255,0,255,0.35);
  padding:16px;
  font-size:13px;
}
.profile-top{
  display:flex;
  gap:12px;
}
.profile-top img{
  width:64px;height:64px;
  border-radius:50%;
  border:3px solid #ff00ff;
}
.profile-name{
  font-size:16px;
}
.profile-status{
  font-size:11px;
  margin-top:4px;
}
.status-dot{
  display:inline-block;
  width:8px;height:8px;
  border-radius:50%;
  margin-right:4px;
  background:#00ff88;
}
.dm-section{
  margin-top:14px;
  border-top:1px solid #31103f;
  padding-top:10px;
}
.dm-list{
  font-size:12px;
  max-height:120px;
  overflow-y:auto;
  margin-bottom:6px;
}

/* SHOP / ABOUT */
.shop-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
  gap:20px;
}
.shop-card{
  background:#05001a;
  border-radius:20px;
  border:1px solid rgba(0,246,255,0.4);
  padding:18px;
  text-align:left;
  font-size:13px;
}
.shop-card h3{font-size:16px;margin-bottom:4px;}
.price{font-size:18px;color:#00ff88;margin:6px 0;}
.shop-card button{
  margin-top:10px;
  border-radius:999px;
  border:none;
  padding:8px 14px;
  font-size:12px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(90deg,#ff00ff,#00f6ff);
  color:#020008;
}

/* FOOTER */
footer{
  padding:20px 0 25px;
  text-align:center;
  font-size:11px;
  color:#888;
}
</style>
</head>
<body>

<nav>
  <div class="nav-left">
    <div>
      <div class="logo">IZENBLOX</div>
      <div class="nav-tagline">Ink-style Roblox community & social hub</div>
    </div>
  </div>
  <div class="nav-links">
    <button onclick="showPage('home')">Home</button>
    <button onclick="showPage('shop')">Shop</button>
    <button onclick="showPage('about')">About</button>
    <button id="navCommunityBtn" onclick="showPage('community')">Community</button>
  </div>
  <div class="nav-right">
    <span id="navUser">Guest</span>
    <button id="navAuthBtn">Sign In</button>
  </div>
</nav>

<!-- HOME PAGE -->
<div class="page active" id="home">
  <div class="hero-wrap">
    <div>
      <div class="hero-title">
        Build your <span>IZENBLOX</span> identity.<br>
        Connect with the Ink Games community.
      </div>
      <div class="hero-sub">
        Custom profiles, public timelines, DM chats and upcoming Ink-style Roblox experiences ‚Äì all tied into the
        <strong>Izenblox Discord</strong>.
      </div>
      <div class="hero-cta">
        <button class="btn-primary" onclick="showPage('auth')">Create your account</button>
        <button class="btn-ghost" onclick="showPage('community')">Jump into community feed</button>
      </div>
    </div>
    <div class="hero-card">
      <div class="hero-pill">Sneak peek ‚Ä¢ Discord</div>
      <h3>Izenblox Discord server drops soon</h3>
      <ul>
        <li>Closed playtests for Squid-style game modes</li>
        <li>Ranked ‚ÄúInk Trials‚Äù with cosmetic rewards</li>
        <li>Events, giveaways, creator collabs</li>
        <li>Special roles for verified Izenblox members</li>
      </ul>
    </div>
  </div>

  <div class="section">
    <h2 style="margin-bottom:18px;">Why people use Izenblox</h2>
    <div class="grid">
      <div class="card">
        <h2>üé≠ Custom Identity</h2>
        <small>Make your profile feel like a main character.</small><br><br>
        <p>Pick animated-style avatars, fonts and bios inspired by cyber-horror Ink aesthetics. Status, pronouns,
        tags ‚Äì all under your control.</p>
        <img src="https://images.unsplash.com/photo-1526481280695-3c687fd543c0?auto=format&fit=crop&w=700&q=80" alt="">
      </div>
      <div class="card">
        <h2>üß™ Ink Games Hub</h2>
        <small>Stay ahead of new releases.</small><br><br>
        <p>See dev logs, teasers and patch notes for upcoming titles like <strong>Ink Trials</strong>,
        <strong>Death Note: Events</strong> and <strong>FNAF: Tragic</strong> before they land on Roblox.</p>
        <img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=700&q=80" alt="">
      </div>
      <div class="card">
        <h2>üí¨ Shared Community Wall</h2>
        <small>Everyone talks in one timeline.</small><br><br>
        <p>A global feed where you can ping other members with <span style="color:#ff9ee5">@mentions</span>,
        reply, like and build reputation through achievements.</p>
        <img src="https://images.unsplash.com/photo-1512428559087-560fa5ceab42?auto=format&fit=crop&w=700&q=80" alt="">
      </div>
      <div class="card">
        <h2>üîó Discord Link-up</h2>
        <small>Izenblox account ‚Üí Discord perks.</small><br><br>
        <p>When the Discord launches, verified Izenblox users will get instant access to exclusive roles, private
        channels and queue priority for custom game nights.</p>
        <img src="https://images.unsplash.com/photo-1511512578047-dfb367046420?auto=format&fit=crop&w=700&q=80" alt="">
      </div>
    </div>
  </div>

  <div class="section">
    <h2 style="margin-bottom:10px;">Izenblox roadmap (short version)</h2>
    <p style="font-size:13px;margin-bottom:12px;">
      We‚Äôre starting with profiles + community wall. Next waves are <strong>friends system</strong>, basic
      <strong>ranked titles</strong>, cosmetic shop and Discord integration.
    </p>
    <ul style="font-size:13px;list-style:none;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;">
      <li>‚óÜ Phase 1 ‚Äì Profiles, wall, DMs (what you‚Äôre using now)</li>
      <li>‚óÜ Phase 2 ‚Äì Friends, status badges, activity pings</li>
      <li>‚óÜ Phase 3 ‚Äì IzenEnergy currency & cosmetic shop</li>
      <li>‚óÜ Phase 4 ‚Äì Discord link, in-game rewards & cross-sync</li>
    </ul>
  </div>
</div>

<!-- AUTH PAGE -->
<div class="page" id="auth">
  <div class="section">
    <h2 style="margin-bottom:18px;">Sign in or create your Izenblox account</h2>
    <div class="auth-grid">
      <!-- Register -->
      <div>
        <div class="auth-title">Create account</div>
        <input id="regUsername" placeholder="Username">
        <input id="regPassword" type="password" placeholder="Password">
        <input id="regPronouns" placeholder="Pronouns (optional)">
        <select id="regFont">
          <option value="Orbitron">Orbitron ‚Äì Futuristic</option>
          <option value="Montserrat">Montserrat ‚Äì Clean</option>
          <option value="Press Start 2P">Pixel ‚Äì Retro</option>
        </select>
        <textarea id="regBio" placeholder="Short bio"></textarea>
        <div style="margin-top:6px;font-size:12px;">Choose a preset avatar</div>
        <div class="avatars">
          <img src="https://i.imgur.com/2yaf2wb.png" onclick="selectAvatar(this.src)">
          <img src="https://i.imgur.com/Y4Qz5WY.png" onclick="selectAvatar(this.src)">
          <img src="https://i.imgur.com/ynQ8KxA.png" onclick="selectAvatar(this.src)">
        </div>
        <div style="margin-top:8px;font-size:12px;">‚Ä¶or upload your own</div>
        <input type="file" id="avatarUpload" accept="image/*">
        <img id="avatarPreview" alt="Avatar preview">
        <button class="btn-primary" style="margin-top:14px;" onclick="register()">Create account</button>
      </div>

      <!-- Login -->
      <div>
        <div class="auth-title">Sign in</div>
        <input id="loginUsername" placeholder="Username">
        <input id="loginPassword" type="password" placeholder="Password">
        <button class="btn-primary" style="margin-top:6px;" onclick="login()">Sign in</button>
        <p style="font-size:12px;margin-top:14px;color:#ccc;">
          Accounts are stored in this browser for now (no email required). When backend hosting is added, these
          profiles can sync to the cloud.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- COMMUNITY PAGE -->
<div class="page" id="community">
  <div class="section">
    <h2 style="margin-bottom:12px;">Community wall</h2>
    <p style="font-size:13px;margin-bottom:16px;">
      Everyone sees the same wall from this device. Use <span style="color:#ff9ee5">@username</span> to mention people.
      You need to be signed in to post.
    </p>

    <div class="community-layout">
      <!-- CHAT COLUMN -->
      <div class="chat-box">
        <div id="chatFeed"></div>
        <div class="chat-input-row">
          <input id="chatInput" placeholder="Share something with the community‚Ä¶">
          <button onclick="createPost()">Post</button>
        </div>
      </div>

      <!-- PROFILE / DM COLUMN -->
      <div class="profile-panel">
        <div id="profileArea">
          <!-- filled by JS -->
        </div>

        <div class="dm-section">
          <div style="font-weight:600;margin-bottom:6px;">Quick DM (local)</div>
          <select id="dmTarget"></select>
          <textarea id="dmText" placeholder="Send a short DM‚Ä¶"></textarea>
          <button class="btn-primary" style="margin-top:4px;font-size:11px;padding:6px 10px;" onclick="sendDM()">Send DM</button>
          <div class="dm-list" id="dmList"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- SHOP PAGE -->
<div class="page" id="shop">
  <div class="section">
    <h2 style="margin-bottom:16px;">Izenblox shop (concept)</h2>
    <p style="font-size:13px;margin-bottom:16px;">
      These are draft products for when payments are wired up. For now they‚Äôre just UI ‚Äì clicking ‚ÄúPurchase‚Äù will show
      mock contact info.
    </p>
    <div class="shop-grid">
      <div class="shop-card">
        <h3>IzenEnergy ‚Äì 1 month</h3>
        <p>+30-day free trial for new members. Boosts your profile with glow themes and early access tags.</p>
        <div class="price">¬£0.99</div>
        <button onclick="mockPurchase('1 month of IzenEnergy')">Purchase</button>
      </div>
      <div class="shop-card">
        <h3>IzenEnergy ‚Äì 3 months</h3>
        <p>Best value for new grinders. Includes seasonal profile borders and beta queue priority.</p>
        <div class="price">¬£1.00</div>
        <button onclick="mockPurchase('3 months of IzenEnergy')">Purchase</button>
      </div>
      <div class="shop-card">
        <h3>IzenEnergy ‚Äì 12 months</h3>
        <p>Lock in a full year of perks, Discord role upgrades and exclusive cosmetics once they launch.</p>
        <div class="price">¬£3.50</div>
        <button onclick="mockPurchase('12 months of IzenEnergy')">Purchase</button>
      </div>
      <div class="shop-card">
        <h3>Custom Discord server build</h3>
        <p>We‚Äôll design, structure and theme a Discord server for your own community.</p>
        <ul style="margin-left:14px;margin-top:6px;font-size:12px;">
          <li>Small starter server ‚Äì ¬£1</li>
          <li>Advanced layered server ‚Äì ¬£5</li>
          <li>‚ÄúTriple A‚Äù pro-grade server ‚Äì ¬£10</li>
        </ul>
        <button onclick="mockPurchase('Custom Discord server build')">Get contact details</button>
      </div>
    </div>
  </div>
</div>

<!-- ABOUT PAGE -->
<div class="page" id="about">
  <div class="section">
    <h2 style="margin-bottom:14px;">About Izenblox</h2>
    <p style="font-size:13px;margin-bottom:10px;">
      Izenblox is a fan-driven hub focused on Roblox games with darker, more cinematic ‚ÄúInk‚Äù energy ‚Äì neon lighting,
      high-tension rounds and story-driven experiences.
    </p>
    <p style="font-size:13px;margin-bottom:10px;">
      This site is currently running as a <strong>static prototype</strong>: accounts, posts and DMs are stored inside
      your browser using <code>localStorage</code>. When the backend is wired up (for example using Firebase or a
      Netlify function API), profiles will sync across devices.
    </p>
    <p style="font-size:13px;">
      Roadmap features include:
    </p>
    <ul style="font-size:13px;margin-left:18px;margin-top:8px;">
      <li>Cloud-synced login system</li>
      <li>Friends & party system for queuing into games together</li>
      <li>Achievement titles that show in-game and on profile</li>
      <li>Discord bot to link your Izenblox account and give roles automatically</li>
    </ul>
  </div>
</div>

<footer>
  Izenblox prototype UI ‚Äì hosted by you. Data is local to your browser for now.
</footer>

<script>
/* ====== BASIC STATE ====== */
let users = JSON.parse(localStorage.getItem("izen_users") || "[]");
let posts = JSON.parse(localStorage.getItem("izen_posts") || "[]");
let dms   = JSON.parse(localStorage.getItem("izen_dms")   || "[]"); // {from,to,text,time}
let currentUsername = localStorage.getItem("izen_current_username") || null;
let currentUser = currentUsername ? users.find(u => u.username === currentUsername) || null : null;
let selectedAvatar = "";

/* ====== HELPERS ====== */
function saveUsers(){ localStorage.setItem("izen_users", JSON.stringify(users)); }
function savePosts(){ localStorage.setItem("izen_posts", JSON.stringify(posts)); }
function saveDMs(){ localStorage.setItem("izen_dms", JSON.stringify(dms)); }

function showPage(id){
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if(id === "community"){ renderChat(); renderProfileSide(); }
}

function updateNav(){
  const navUser = document.getElementById("navUser");
  const navBtn  = document.getElementById("navAuthBtn");
  if(currentUser){
    navUser.textContent = currentUser.username + " ‚úì";
    navBtn.textContent = "Logout";
    navBtn.onclick = logout;
  }else{
    navUser.textContent = "Guest";
    navBtn.textContent = "Sign In";
    navBtn.onclick = () => showPage("auth");
  }
}

/* ====== AVATAR SELECTION ====== */
function selectAvatar(src){
  selectedAvatar = src;
  document.getElementById("avatarPreview").src = src;
}
document.getElementById("avatarUpload").addEventListener("change", e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    selectedAvatar = reader.result;
    document.getElementById("avatarPreview").src = reader.result;
  };
  reader.readAsDataURL(file);
});

/* ====== AUTH ====== */
function register(){
  const username = document.getElementById("regUsername").value.trim();
  const password = document.getElementById("regPassword").value;
  const pronouns = document.getElementById("regPronouns").value.trim();
  const bio      = document.getElementById("regBio").value.trim();
  const font     = document.getElementById("regFont").value;

  if(!username || !password || !selectedAvatar){
    alert("Please enter username, password and choose an avatar.");
    return;
  }
  if(users.find(u => u.username.toLowerCase() === username.toLowerCase())){
    alert("That username is already taken.");
    return;
  }

  const user = {
    username,
    password,
    pronouns,
    bio,
    font,
    avatar: selectedAvatar,
    createdAt: new Date().toISOString(),
    status: "online"
  };
  users.push(user);
  saveUsers();
  currentUser = user;
  currentUsername = user.username;
  localStorage.setItem("izen_current_username", currentUsername);
  updateNav();
  alert("Account created. You are now signed in.");
  showPage("community");
  renderProfileSide();
}

function login(){
  const username = document.getElementById("loginUsername").value.trim();
  const password = document.getElementById("loginPassword").value;
  const user = users.find(u => u.username === username && u.password === password);
  if(!user){
    alert("Wrong username or password.");
    return;
  }
  currentUser = user;
  currentUsername = user.username;
  localStorage.setItem("izen_current_username", currentUsername);
  updateNav();
  alert("Signed in as " + user.username);
  showPage("community");
  renderProfileSide();
}

function logout(){
  currentUser = null;
  currentUsername = null;
  localStorage.removeItem("izen_current_username");
  updateNav();
  renderProfileSide();
}

/* ====== COMMUNITY WALL ====== */
function highlightMentions(text){
  return text.replace(/@([A-Za-z0-9_]+)/g,'<span class="mention">@$1</span>');
}

function createPost(){
  if(!currentUser){
    alert("You need to sign in to post.");
    showPage("auth");
    return;
  }
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if(!text) return;
  posts.push({
    id: Date.now(),
    user: currentUser.username,
    avatar: currentUser.avatar,
    text,
    time: new Date().toLocaleTimeString(),
    likes: 0
  });
  savePosts();
  input.value = "";
  renderChat();
}

function likePost(id){
  const p = posts.find(x => x.id === id);
  if(!p) return;
  p.likes++;
  savePosts();
  renderChat();
}

function replyTo(user){
  const input = document.getElementById("chatInput");
  input.value = "@" + user + " " + input.value;
  input.focus();
}

function renderChat(){
  const feed = document.getElementById("chatFeed");
  feed.innerHTML = "";
  posts.forEach(p=>{
    const div = document.createElement("div");
    div.className = "message";
    div.innerHTML = `
      <div class="msg-header">
        <div class="msg-user">
          <img src="${p.avatar}" alt="">
          <div>
            <div>${p.user}${p.user === currentUsername ? " ‚úì" : ""}</div>
            <div class="msg-meta">${p.time}</div>
          </div>
        </div>
        <div class="msg-actions">
          <span class="like" onclick="likePost(${p.id})">‚ô• ${p.likes}</span>
          <span onclick="replyTo('${p.user}')">Reply</span>
        </div>
      </div>
      <div>${highlightMentions(p.text)}</div>
    `;
    feed.appendChild(div);
  });
  feed.scrollTop = feed.scrollHeight;
}

/* ====== PROFILE SIDE + DMS ====== */
function renderProfileSide(){
  const area = document.getElementById("profileArea");
  const dmTarget = document.getElementById("dmTarget");
  const dmList = document.getElementById("dmList");

  dmTarget.innerHTML = "";
  dmList.innerHTML = "";

  if(!currentUser){
    area.innerHTML = `
      <div style="font-size:13px;">
        You‚Äôre browsing as <strong>guest</strong>.<br><br>
        Create an account to set your profile, post on the wall and send DMs.
      </div>
    `;
    return;
  }

  area.innerHTML = `
    <div class="profile-top" style="font-family:${currentUser.font},Orbitron;">
      <img src="${currentUser.avatar}" alt="">
      <div>
        <div class="profile-name">${currentUser.username} ‚úì</div>
        <div class="profile-status">
          <span class="status-dot"></span> online
        </div>
        <div style="font-size:11px;margin-top:4px;">${currentUser.pronouns || ""}</div>
      </div>
    </div>
    <div style="margin-top:10px;font-size:12px;">${currentUser.bio || "No bio yet."}</div>
  `;

  // DM target options = all other users
  const others = users.filter(u=>u.username !== currentUser.username);
  if(others.length === 0){
    dmTarget.innerHTML = `<option>No other local users yet</option>`;
  }else{
    others.forEach(u=>{
      const opt = document.createElement("option");
      opt.value = u.username;
      opt.textContent = u.username;
      dmTarget.appendChild(opt);
    });
  }

  // Show last 10 DMs involving current user
  const threads = dms.filter(m => m.from === currentUser.username || m.to === currentUser.username).slice(-10);
  if(threads.length === 0){
    dmList.innerHTML = "<div style='font-size:11px;color:#aaa;margin-top:4px;'>No DMs yet.</div>";
  }else{
    threads.forEach(m=>{
      const item = document.createElement("div");
      item.style.marginBottom = "4px";
      item.style.fontSize = "11px";
      const dir = m.from === currentUser.username ? "‚Üí" : "‚Üê";
      item.textContent = `${dir} ${m.to === currentUser.username ? m.from : m.to}: ${m.text}`;
      dmList.appendChild(item);
    });
  }
}

function sendDM(){
  if(!currentUser){
    alert("Sign in to send DMs.");
    return;
  }
  const target = document.getElementById("dmTarget").value;
  const text = document.getElementById("dmText").value.trim();
  if(!target || !text) return;
  dms.push({
    from: currentUser.username,
    to: target,
    text,
    time: new Date().toISOString()
  });
  saveDMs();
  document.getElementById("dmText").value = "";
  renderProfileSide();
}

/* ====== SHOP MOCK PURCHASE ====== */
function mockPurchase(item){
  alert(
    "This is a mock purchase for now.\n\n" +
    "Item: " + item + "\n\n" +
    "For real orders, contact:\nDiscord: IzenOwner#0001\nEmail: contact@izenblox.dev (placeholder)"
  );
}

/* ====== INIT ====== */
updateNav();
renderChat();
renderProfileSide();
</script>

</body>
</html>
